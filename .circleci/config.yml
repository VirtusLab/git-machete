version: 2.1

executors:
  windows_executor:
    machine:
      image: windows-server-2022-gui:2023.03.1
      shell: powershell.exe
    # Jobs using windows.large sometimes get stuck on `Preparing environment` :/
    resource_class: windows.medium

jobs:
  "windows tests":
    executor: windows_executor
    steps:
      - run: git clone https://github.com/PawelLipski/ScoopInstallerMain -b add/git-machete --depth=1
      - run: |
          iex "& {$(irm get.scoop.sh)} -RunAsAdmin"
          cd ScoopInstallerMain
          scoop install bucket\git-machete.json
          git machete help
          git machete version
          scoop config debug $true
          .\bin\checkver.ps1 git-machete -u
          git diff

workflows:
  version: 2
  build:
    jobs:
      - windows tests
